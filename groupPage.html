<!DOCTYPE html>
<html>
<head>
	
    <!-- Firebase App is always required and must be first -->
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-app.js"></script>

    <!-- Add additional services that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-functions.js"></script>
    <script src="./API.js"></script>
	<script src="./user.js"></script>
	<script src="./Login.js" type="text/javascript"></script>
	<script src="./utils.js" type="text/javascript"></script>
	<script src="./match.js" type="text/javascript"></script>
    <title></title>
</head>
<body onload = "fetch_all_users()">
	<a onclick="window.open('./my_group.html')">Manage my groups</a>
	<div>
		<select id = "subject1">
		    <option selected disabled>Subject</option>
		    <option value="COMPSCI">COMPSCI</option>
		</select>
		<select id = "classnumber1">
		    <option selected disabled></option>
		    <option value = "s1c1">61A</option>
		    <option value = "s1c2">61B</option>
		    <option value = "s1c3">61C</option>
		</select>
	</div>
	<div>
		<select id = "subject2">
		    <option selected disabled>Subject</option>
		    <option value="COMPSCI">COMPSCI</option>
		    <!--<option value="MATH">MATH</option> -->
		</select>
		<select id = "classnumber2">
		    <option selected disabled></option>
		    <option value = "s2c1">61A</option>
		    <option value = "s2c2">61B</option>
		    <option value = "s2c3">61C</option>
		</select>
	</div>
	<input type="button" name="match" value = "match" onclick = "get_group()">
	<div id = "group"></div>
<script>
	function create_group_div(group, index) {
		var groupname = "Group name:" + group["name"];
		var groupmembers = "Group Members:";
		for (var uid in group["student"]) {
			groupmembers += get_user_name_uid(uid);
		}

		var parent = document.getElementById('group');
			var groupdiv = document.createElement('div');
			groupdiv.innerHTML = "recommandgroup"+groupPage+":";

				var namediv = document.createElement('div');
				namediv.innerHTML = groupname;
				var memberdiv = document.createElement('div');
				memberdiv.innerHTML = groupmembers;
				var join = document.createElement('input');
				join.setAttribute("type", "button");
				join.setAttribute("value", "join");
				join.setAttribute("id", group[id]);
				join.setAttribute("onclick", "join(this.id)");

			groupdiv.appendChild(namediv);
			groupdiv.appendChild(memberdiv);
			groupdiv.appendChild(join);
		parent.appendChild(groupdiv);
	}
	function create_new_group(){
		var parent = document.getElementById('group');
			var groupdiv = document.createElement('div');
				groupdiv.innerHTML = "No group exists. Enter name to create a new one:";
				var name = document.createElement('input');
				name.setAttribute('type', 'text');
				name.setAttribute('id', 'new_name');
				var create_button = document.createElement('button');
				create_button.setAttribute('value', "create");
				create_button.setAttribute("onclick", "create_group()");
			groupdiv.appendChild(name);
			groupdiv.appendChild(create_button);
		parent.appendChild(groupdiv);
	}
	function get_group() {
		let uid = fetch_user_id();
		let classes = [{key: document.getElementById("subject1"),
			value: document.getElementById("classnumber1")}, {key: document.getElementById("subject2"),
			value: document.getElementById("classnumber2")}];
		var recommandgroups = match_groups(uid, classes);
		if (recommandgroups == null) {
			create_new_group();
		} else {
			var i = 1;
			for (var group in recommandgroups) {
				create_group_div(group, i);
				i++;
			}
		}

	}
    
</script>
</body>
</html>